import fs from "node:fs/promises";
import { createRepositoryOnGitHub } from "../modes/createRepositoryOnGitHub.js";
import { createTrackingBranches } from "../modes/createTrackingBranches.js";
import { producePreset } from "../producers/producePreset.js";
import { createSystemContext } from "../system/createSystemContext.js";
import { applyCreation } from "./applyCreation.js";
export async function runPreset(preset, settings) {
    const { directory = "." } = settings;
    await fs.mkdir(directory, { recursive: true });
    const system = createSystemContext({
        directory,
        ...settings,
    });
    const { creation, options } = await producePreset(preset, 
    // TODO: Why is this assertion necessary?
    {
        ...system,
        ...settings,
    });
    if (settings.mode === "initialize") {
        // TODO: Hardcode owner and repository existing in options?
        await createRepositoryOnGitHub(options, system.runner, preset.base.template);
    }
    await applyCreation(creation, system);
    if (settings.mode === "initialize") {
        await createTrackingBranches(options, system.runner);
    }
}
//# sourceMappingURL=runPreset.js.map